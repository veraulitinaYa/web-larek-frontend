# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

<b>Продукт:</b>

```
interface IProduct {
  id: string;
  title: string;
  description: string;
  image: string;
  category: string;
  price: number;
}
```

<b>Заказ: </b>

```
interface IOrder {
  paymentType: string;
  address: string;
  email: string;
  telephone: string;
}
```

<b>Коллекция продуктов, доступных в магазине:</b>

``` 
interface IStore {
  products: IProduct[]; 
  previewSelectedProductId: string | null;
} 
```


<b>Коллекция продуктов, помещенных в корзину:</b>
``` 
interface ICart {
  products: IProduct[];
  totalCost: number;
}
```

<b>Модель данных коллекции товаров, доступных в магазине:</b>

```
interface IStoreData{
  getCatalog(): IProduct[];
  fillCatalog(products: IProduct[]): void;
}
```

<b>Модель данных коллекции продуктов, помещенных в корзину:</b>
``` 
interface ICartData{
  addProduct(product: TProductIdModalCart): void;
  deleteProduct(product: TProductIdModalCart): void;
  getTotalCost(): number;
}
```

<b>Модель данных заказа:</b>

```
interface IOrderData {
  choosePaymentType(paymentType: string): void;
  getAddress(): string;
  getEmail(): string;
  getTelephone(): string;
  clearData(): void;
  validateData(): boolean;
}
```




<b>Данные карточки продукта, отображающиеся на главной странице:</b>
```
type TProductCardMain = Pick<IProduct, 'id' | 'title' | 'image' | 'category' | 'price'>;
```
<b>Данные карточки продукта для отображения в превью:</b>
```
type TProductCardModalPreview = Pick<IProduct, 'id' >;
```
<b>Данные карточки продукта, отображающиеся в строке корзины:</b>
```
type TProductCardCart = Pick<IProduct, 'id' | 'title' | 'price'>;
```

<b>Данные заказа, отображающиеся в корзине:</b>
```
type TOrderCartContents = Pick<IOrder, 'orderList'>;
```
<b>Данные заказа, вносимые в форму, которая принимает тип платежа и адрес: </b>
```
type TOrderPaymentAddressForm = Pick<IOrder, 'paymentType' | 'address'>;
```
<b>Данные заказа, вносимые в форму, которая принимает email и телефон: </b>
```
type TOrderEmailTelephoneForm = Pick<IOrder, 'email' | 'telephone'>;
```
<b>Данные заказа, выводящиеся в закрывающем модальном окне после успешного заказа:</b>
```
export type TFinalizeOrderModal = Pick<ICartData, 'totalCost'>;
```

## Архитектура приложения

### Описание

В приложении используется архитектура <b>MVP</b> (Model-View-Presenter).
Как и требует модель, код делится на три основные части. 

<b>Слой/модель данных</b> отвечает за обработку, хранение и управление данными. Элементы этого слоя самостоятельны и не зависят от отображения или презентера.
<b>Слой представления/отображения</b> - это пользовательский интерфейс. От отвечает за отображение данных. 
<b>Презентер</b> отвечает за связь данных и представления.

Также описаны классы, которые поддерживают функциональность приложения. Они выделены в раздел <b>Базовый код</b>.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. 
 
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой/модель данных
#### Класс ProductData
Класс отвечает за хранение и логику работы с данными карточек товара.
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:

- `productList: IProduct[]` - массив объектов карточек товара.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

#### Класс StoreData
Класс отвечает за хранение и логику работы с данными магазина.
Конструктор класса принимает инстант брокера событий.

Класс предоставляет набор методов для взаимодействия с данными магазина:

- `getCatalog(): IProduct[];` - возвращает каталог продуктов магажина.
- `fillCatalog(products: IProduct[]): void` - получает каталог продуктов с сервера.

#### Класс CartData
Класс отвечает за хранение и логику работы с данными товаров в корзине.
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:

- `products: TProductIdModalCart[]` - массив карточек товара в корзине.
- `totalCost: number` - сумма стоимости товаров в корзине.

Класс предоставляет набор методов для взаимодействия с данными магазина:

- `addProduct(product: TProductIdModalCart): void` - добавить продукт в корзину. 
- `deleteProduct(product: TProductIdModalCart): void` - удалить продукт из корзины. 
- `getTotalCost(): number` - получить суммарную стоимость всех товаров в корзине. 
- `clearCart(): void` - очистить корзину. 
- `getCart(): ICart` - получить массив товаров в корзине. 

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными заказа.
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- `paymentType: string` - тип оплаты.
- `address: string`- адрес.
- `email: string` - почта.
- `telephone: string` - номер телефона.

Класс предоставляет набор методов для взаимодействия с данными заказа:
-`getPaymentType(paymentType: string): void` - получить тип оплаты.
-`setPaymentType(paymentType: string): void` - записать тип оплаты.
-`getAddress(): string` - получить адрес.
-`setAddress(address: string): void` - записать адрес.
-`getEmail(): string` - получить почту.
-`setEmail(email: string): void` - записать почту.
-`getTelephone(): string` - получить номер телефона.
-`setTelephone(telephone: string): void` - записать номер телефона.
-`clearData(): void` - очистить данные.
-`validateData(): boolean` - валидировать данные.

### Слой представления/отображения
Все классы представления отвечают за отображение внутри контейнера передаваемых в них данных.


#### Класс Store
Реализует отображение массива карточек на странице магазина.

В конструктор передается массив карточек.


Поля класса:
- `modal: HTMLElement` - контейнер для карточек.
- `events: IEvents` - брокер событий.

Методы класа:
- `fillCatalog(products: IProduct[]): void` - заполнить контейнер для карточек карточками.


#### Класс Modal
Реализует модальное окно. Также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик на оверлей и на кнопку-крестик для закрытия модального окна.
- `constructor(container: HTMLElement, events: IEvents)` Конструктор принимает `container`, в котором будет разметка содержимого модального окна и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `modal: HTMLElement` - элемент модального окна.
- `events: IEvents` - брокер событий.

#### Класс Card

Предназначен для реализации карточек товара на главной странице.
- `constructor(container: HTMLElement, events: IEvents)` Конструктор принимает `container`, который будет показывать карточки, и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
-`id: string` - id продукта.
-`title: string` - элемент карточки с названием продукта.
-`image: string` - элемент карточки с изображением продукта.
-`category: string` - элемент карточка с категорией продукта.
-`price: number` - элемент карточки с ценой продукта.

#### Класс ModalWithCardPreview

Предназначен для реализации карточек товара на главной странице.
- `constructor(container: HTMLElement, events: IEvents)` Конструктор принимает `container`, в котором будет разметка содержимого модального окна и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
-`id: string` - id продукта.
-`title: string` - элемент карточки с названием продукта.
-`description: string` - элемент карточки с описанием продукта.
-`image: string` - элемент карточки с изображением продукта.
-`category: string` - элемент карточка с категорией продукта.
-`price: number` - элемент карточки с ценой продукта.


#### Класс ModalFinalizeOrder
Расширяет класс Modal. Предназначен для реализации модального окна финализации заказа.

Поля класса:
- `orderTotal: number` - хранит сумму заказа.
- `submitButton: HTMLButtonElement` - кнопка подтверждения.

Методы класа:
- `fillCatalog(products: IProduct[]): void` - заполнить контейнер для карточек карточками.

#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна с формами.

Конструктор принимает форму, которая будет отображаться в модальном окне, модальное окно, которое будет показывать форму, и экземпляр класса `EventEmitter` для возможности инициации событий.

Методы класса:
- `showForm: void` - показать форму в модальном окне.

#### Класс Form
Реализует форму. Иницилизирует событие, оповещающее об изменении полей. Отправляет данные в модель по нажатию кнопки sumbit. Изменят состояние кнопки sumbit, в зависимости от валидности полей.

Поля класса:
- `_submit: HTMLButtonElement` - кнопка отправки данных формы
- `_errors: HTMLElement` - элемент, в котором отображаются ошибки при не валидности полей

Методы:
- `onInputChange(field: keyof T, value: string)` - защещенной метод. Инициализирует событие, при котором передаются данный поля и введенных в него данных.

#### Класс FormPaymentAddress

Расширяет класс Form. Реализует форму заказа с выбором оплаты и введением адреса. 

Поля класса:
- `paymentButtonOnline: HTMLButtonElement` - оплата онлайн.
- `paymentButtonOnReception: HTMLButtonElement` - оплата при получении.
- `selectedPayment: string` - переменная, хранящая выбранный метод оплаты.
- `address: string` - переменная, хранящая адрес.

Методы:
- `setPaymentType: string` - записать тип оплаты.
- `setAddress: string` - записать адрес.

#### Класс FormEmailPhone
Расширяет класс Form. Реализует форму заказа. Устанавливает значение полей. 

Поля класса:
- `email: string` - переменная, хранящая email.
- `phone: string` - переменная, хранящая телефон.

Методы:
- `setEmail: string` - записать email.
- `setPhone: string` - записать телефон.

#### Класс Cart
Предназначет для реализации модального окна корзины.

Конструктор принимает список карточек, который будет отображаться в модальном окне, модальное окно, которое будет показывать форму, и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
-products - показывает список карточек продуктов.
-totalCost - показывает общую стоимость.
-orderButton - показывает кнопку заказа.

### Презентер

Так как приложение сравнительно небольшое, отдельный компонент не создается. Код, отвечающий за взаимодействие отображения и данных помещен в index.ts.

#### Класс LarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса. Используется событийно-ориентированный подход.

В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.
